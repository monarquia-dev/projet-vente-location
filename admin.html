<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Administration - GRÂCE AUTO SERVICE</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Styles spécifiques à l'admin */
        .admin-container {
            display: flex;
            min-height: 100vh;
            background: #f5f7fa;
        }

        /* Sidebar */
        .admin-sidebar {
            width: 250px;
            background: #2c3e50;
            color: white;
            padding: 2rem 0;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            box-shadow: 2px 0 10px rgba(0,0,0,0.1);
        }

        .admin-logo {
            text-align: center;
            padding: 0 1rem 2rem;
            border-bottom: 1px solid #34495e;
            margin-bottom: 2rem;
        }

        .admin-logo h1 {
            font-size: 1.2rem;
            color: white;
            margin-bottom: 0.5rem;
        }

        .admin-logo p {
            color: #bdc3c7;
            font-size: 0.9rem;
        }

        .admin-nav {
            padding: 0 1rem;
        }

        .admin-nav-item {
            display: flex;
            align-items: center;
            gap: 0.8rem;
            padding: 0.8rem 1rem;
            color: #ecf0f1;
            text-decoration: none;
            border-radius: 4px;
            margin-bottom: 0.5rem;
            transition: all 0.3s;
        }

        .admin-nav-item:hover {
            background: rgba(255,255,255,0.1);
            color: white;
        }

        .admin-nav-item.active {
            background: #3498db;
            color: white;
        }

        .admin-nav-item i {
            width: 20px;
            text-align: center;
        }

        .logout-btn {
            margin-top: auto;
            background: #e74c3c;
            color: white !important;
        }

        .logout-btn:hover {
            background: #c0392b;
        }

        /* Main Content */
        .admin-main {
            flex: 1;
            margin-left: 250px;
            padding: 2rem;
        }

        .admin-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid #e0e6ed;
        }

        .admin-header h2 {
            color: #2c3e50;
            font-size: 1.8rem;
        }

        .sync-info {
            background: #f8f9fa;
            padding: 0.8rem 1.5rem;
            border-radius: 4px;
            color: #7f8c8d;
            font-size: 0.9rem;
            border-left: 3px solid #3498db;
        }

        /* Tableau */
        .admin-table-container {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            overflow: hidden;
        }

        .table-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1.5rem;
            background: #f8f9fa;
            border-bottom: 1px solid #e0e6ed;
        }

        .table-actions {
            display: flex;
            gap: 1rem;
        }

        .search-box {
            position: relative;
            width: 300px;
        }

        .search-box input {
            width: 100%;
            padding: 0.8rem 1rem 0.8rem 2.5rem;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 0.9rem;
        }

        .search-box i {
            position: absolute;
            left: 0.8rem;
            top: 50%;
            transform: translateY(-50%);
            color: #95a5a6;
        }

        .admin-table {
            width: 100%;
            border-collapse: collapse;
        }

        .admin-table th {
            background: #f8f9fa;
            padding: 1rem;
            text-align: left;
            font-weight: 600;
            color: #2c3e50;
            border-bottom: 2px solid #e0e6ed;
        }

        .admin-table td {
            padding: 1rem;
            border-bottom: 1px solid #e0e6ed;
            vertical-align: middle;
        }

        .admin-table tr:hover {
            background: #f8f9fa;
        }

        .item-image-small {
            width: 60px;
            height: 40px;
            border-radius: 4px;
            object-fit: cover;
        }

        .status-badge {
            display: inline-block;
            padding: 0.3rem 0.8rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .status-disponible {
            background: #2ecc71;
            color: white;
        }

        .status-vendu {
            background: #e74c3c;
            color: white;
        }

        .status-loué {
            background: #3498db;
            color: white;
        }

        .type-badge {
            background: #f8f9fa;
            color: #2c3e50;
            padding: 0.3rem 0.8rem;
            border-radius: 4px;
            font-size: 0.8rem;
        }

        .actions-cell {
            display: flex;
            gap: 0.5rem;
        }

        .action-btn {
            padding: 0.4rem 0.8rem;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.3s;
        }

        .btn-edit {
            background: #3498db;
            color: white;
        }

        .btn-delete {
            background: #e74c3c;
            color: white;
        }

        .btn-view {
            background: #95a5a6;
            color: white;
        }

        .btn-sync {
            background: #2ecc71;
            color: white;
        }

        /* Modals */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 8px;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .modal-header {
            padding: 1.5rem;
            border-bottom: 1px solid #e0e6ed;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h3 {
            color: #2c3e50;
            margin: 0;
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #95a5a6;
        }

        .modal-body {
            padding: 1.5rem;
        }

        .modal-footer {
            padding: 1.5rem;
            border-top: 1px solid #e0e6ed;
            text-align: right;
        }

        /* Formulaires */
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
        }

        .form-group {
            margin-bottom: 1rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            color: #2c3e50;
            font-weight: 600;
        }

        .form-control {
            width: 100%;
            padding: 0.8rem;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 1rem;
        }

        .form-control:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
        }

        /* Stats Cards */
        .stats-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: white;
            padding: 1.5rem;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            text-align: center;
        }

        .stat-card i {
            font-size: 2rem;
            margin-bottom: 1rem;
        }

        .stat-card h3 {
            font-size: 2rem;
            color: #2c3e50;
            margin-bottom: 0.5rem;
        }

        .stat-card p {
            color: #7f8c8d;
        }

        .icon-vehicule { color: #3498db; }
        .icon-residence { color: #2ecc71; }
        .icon-client { color: #9b59b6; }
        .icon-sync { color: #f39c12; }

        /* Responsive */
        @media (max-width: 992px) {
            .admin-sidebar {
                width: 200px;
            }
            .admin-main {
                margin-left: 200px;
            }
        }

        @media (max-width: 768px) {
            .admin-container {
                flex-direction: column;
            }
            
            .admin-sidebar {
                width: 100%;
                height: auto;
                position: relative;
                padding: 1rem;
            }
            
            .admin-main {
                margin-left: 0;
            }
            
            .admin-nav {
                display: flex;
                flex-wrap: wrap;
                gap: 0.5rem;
            }
            
            .admin-nav-item {
                flex: 1;
                min-width: 120px;
                justify-content: center;
            }
            
            .table-header {
                flex-direction: column;
                gap: 1rem;
                align-items: stretch;
            }
            
            .search-box {
                width: 100%;
            }
        }

        @media (max-width: 576px) {
            .admin-table {
                display: block;
                overflow-x: auto;
            }
            
            .stats-cards {
                grid-template-columns: 1fr;
            }
            
            .form-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="admin-container">
        <!-- Sidebar -->
        <aside class="admin-sidebar">
            <div class="admin-logo">
                <h1>GRÂCE AUTO SERVICE</h1>
                <p>Administration</p>
            </div>
            
            <nav class="admin-nav">
                <a href="#" class="admin-nav-item active" data-section="dashboard">
                    <i class="fas fa-tachometer-alt"></i>
                    Tableau de bord
                </a>
                <a href="#" class="admin-nav-item" data-section="vehicules">
                    <i class="fas fa-car"></i>
                    Véhicules
                </a>
                <a href="#" class="admin-nav-item" data-section="residences">
                    <i class="fas fa-home"></i>
                    Résidences
                </a>
                <a href="#" class="admin-nav-item" data-section="reservations">
                    <i class="fas fa-calendar-check"></i>
                    Réservations
                </a>
                <a href="#" class="admin-nav-item" data-section="settings">
                    <i class="fas fa-cog"></i>
                    Paramètres
                </a>
                <a href="#" class="admin-nav-item" data-section="database">
                    <i class="fas fa-database"></i>
                    Base de données
                </a>
                <a href="index.html" class="admin-nav-item">
                    <i class="fas fa-external-link-alt"></i>
                    Retour au site
                </a>
                <a href="#" class="admin-nav-item logout-btn" id="logoutBtn">
                    <i class="fas fa-sign-out-alt"></i>
                    Déconnexion
                </a>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="admin-main">
            <!-- Header -->
            <div class="admin-header">
                <h2 id="sectionTitle">Tableau de bord</h2>
                <div class="sync-info">
                    <i class="fas fa-sync-alt"></i>
                    Dernière synchronisation: <span id="lastSync">Maintenant</span>
                </div>
            </div>

            <!-- Dashboard Section -->
            <section id="dashboardSection" class="admin-section">
                <div class="stats-cards">
                    <div class="stat-card">
                        <i class="fas fa-car icon-vehicule"></i>
                        <h3 id="totalVehicules">0</h3>
                        <p>Véhicules</p>
                    </div>
                    <div class="stat-card">
                        <i class="fas fa-home icon-residence"></i>
                        <h3 id="totalResidences">0</h3>
                        <p>Résidences</p>
                    </div>
                    <div class="stat-card">
                        <i class="fas fa-users icon-client"></i>
                        <h3 id="totalReservations">0</h3>
                        <p>Réservations</p>
                    </div>
                    <div class="stat-card">
                        <i class="fas fa-sync-alt icon-sync"></i>
                        <h3 id="connectedClients">0</h3>
                        <p>Clients connectés</p>
                    </div>
                </div>

                <div class="admin-table-container">
                    <div class="table-header">
                        <h3>Activité récente</h3>
                        <button class="btn btn-primary" id="syncNowBtn">
                            <i class="fas fa-sync-alt"></i>
                            Synchroniser
                        </button>
                    </div>
                    <table class="admin-table">
                        <thead>
                            <tr>
                                <th>Type</th>
                                <th>Titre</th>
                                <th>Prix</th>
                                <th>Statut</th>
                                <th>Date</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="recentActivity">
                            <!-- Rempli par JavaScript -->
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Véhicules Section -->
            <section id="vehiculesSection" class="admin-section" style="display: none;">
                <div class="admin-table-container">
                    <div class="table-header">
                        <h3>Gestion des véhicules</h3>
                        <div class="table-actions">
                            <div class="search-box">
                                <i class="fas fa-search"></i>
                                <input type="text" id="searchVehicules" placeholder="Rechercher un véhicule...">
                            </div>
                            <button class="btn btn-primary" id="addVehiculeBtn">
                                <i class="fas fa-plus"></i>
                                Ajouter un véhicule
                            </button>
                        </div>
                    </div>
                    <table class="admin-table">
                        <thead>
                            <tr>
                                <th>Image</th>
                                <th>Titre</th>
                                <th>Type</th>
                                <th>Prix</th>
                                <th>Statut</th>
                                <th>Disponibilité</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="vehiculesTable">
                            <!-- Rempli par JavaScript -->
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Résidences Section -->
            <section id="residencesSection" class="admin-section" style="display: none;">
                <div class="admin-table-container">
                    <div class="table-header">
                        <h3>Gestion des résidences</h3>
                        <div class="table-actions">
                            <div class="search-box">
                                <i class="fas fa-search"></i>
                                <input type="text" id="searchResidences" placeholder="Rechercher une résidence...">
                            </div>
                            <button class="btn btn-primary" id="addResidenceBtn">
                                <i class="fas fa-plus"></i>
                                Ajouter une résidence
                            </button>
                        </div>
                    </div>
                    <table class="admin-table">
                        <thead>
                            <tr>
                                <th>Image</th>
                                <th>Titre</th>
                                <th>Localisation</th>
                                <th>Prix/mois</th>
                                <th>Pièces</th>
                                <th>Disponibilité</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="residencesTable">
                            <!-- Rempli par JavaScript -->
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Réservations Section -->
            <section id="reservationsSection" class="admin-section" style="display: none;">
                <div class="admin-table-container">
                    <div class="table-header">
                        <h3>Gestion des réservations</h3>
                        <div class="search-box">
                            <i class="fas fa-search"></i>
                            <input type="text" id="searchReservations" placeholder="Rechercher une réservation...">
                        </div>
                    </div>
                    <table class="admin-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Client</th>
                                <th>Item</th>
                                <th>Type</th>
                                <th>Date début</th>
                                <th>Date fin</th>
                                <th>Statut</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="reservationsTable">
                            <!-- Rempli par JavaScript -->
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Paramètres Section -->
            <section id="settingsSection" class="admin-section" style="display: none;">
                <div class="admin-table-container">
                    <div class="table-header">
                        <h3>Paramètres du site</h3>
                    </div>
                    <div class="modal-body">
                        <form id="settingsForm">
                            <div class="form-grid">
                                <div class="form-group">
                                    <label>Nom du site</label>
                                    <input type="text" class="form-control" name="name" required>
                                </div>
                                <div class="form-group">
                                    <label>Description</label>
                                    <input type="text" class="form-control" name="description" required>
                                </div>
                                <div class="form-group">
                                    <label>Téléphone principal</label>
                                    <input type="tel" class="form-control" name="contactPhone" required>
                                </div>
                                <div class="form-group">
                                    <label>Email de contact</label>
                                    <input type="email" class="form-control" name="contactEmail" required>
                                </div>
                                <div class="form-group">
                                    <label>Horaires (Lun-Ven)</label>
                                    <input type="text" class="form-control" name="weekdayHours" required>
                                </div>
                                <div class="form-group">
                                    <label>Horaires (Samedi)</label>
                                    <input type="text" class="form-control" name="saturdayHours" required>
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button type="submit" class="btn btn-primary">
                                    <i class="fas fa-save"></i>
                                    Enregistrer les paramètres
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </section>

            <!-- Base de données Section -->
            <section id="databaseSection" class="admin-section" style="display: none;">
                <div class="admin-table-container">
                    <div class="table-header">
                        <h3>Gestion de la base de données</h3>
                    </div>
                    <div class="modal-body">
                        <div style="text-align: center; padding: 3rem;">
                            <i class="fas fa-database" style="font-size: 4rem; color: #3498db; margin-bottom: 1rem;"></i>
                            <h3 style="margin-bottom: 1rem;">Gestion des données</h3>
                            <p style="color: #7f8c8d; margin-bottom: 2rem;">
                                Gérez ici l'ensemble des données du site. Vous pouvez exporter, importer ou sauvegarder la base de données.
                            </p>
                            
                            <div style="display: flex; flex-wrap: wrap; gap: 1rem; justify-content: center;">
                                <button class="btn btn-primary" id="exportDataBtn">
                                    <i class="fas fa-download"></i>
                                    Exporter les données
                                </button>
                                <button class="btn btn-secondary" id="importDataBtn">
                                    <i class="fas fa-upload"></i>
                                    Importer des données
                                </button>
                                <button class="btn btn-danger" id="backupDataBtn">
                                    <i class="fas fa-save"></i>
                                    Sauvegarder maintenant
                                </button>
                                <button class="btn btn-outline" id="resetDataBtn">
                                    <i class="fas fa-redo"></i>
                                    Réinitialiser les données
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- Modals -->
    <!-- Modal Ajouter/Éditer Véhicule -->
    <div id="vehiculeModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="vehiculeModalTitle">Ajouter un véhicule</h3>
                <button class="close-modal">&times;</button>
            </div>
            <form id="vehiculeForm">
                <div class="modal-body">
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Titre *</label>
                            <input type="text" class="form-control" name="titre" required>
                        </div>
                        <div class="form-group">
                            <label>Catégorie *</label>
                            <select class="form-control" name="categorie" required>
                                <option value="vente">Vente</option>
                                <option value="location">Location</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Prix (FCFA) *</label>
                            <input type="number" class="form-control" name="prix" required>
                        </div>
                        <div class="form-group">
                            <label>URL de l'image *</label>
                            <input type="url" class="form-control" name="image" required>
                        </div>
                        <div class="form-group">
                            <label>Type *</label>
                            <input type="text" class="form-control" name="type" required>
                        </div>
                        <div class="form-group">
                            <label>Disponibilité *</label>
                            <select class="form-control" name="disponible" required>
                                <option value="true">Disponible</option>
                                <option value="false">Non disponible</option>
                            </select>
                        </div>
                        <div class="form-group" style="grid-column: 1 / -1;">
                            <label>Description *</label>
                            <textarea class="form-control" name="description" rows="3" required></textarea>
                        </div>
                        <div class="form-group" style="grid-column: 1 / -1;">
                            <label>Caractéristiques (séparées par des virgules) *</label>
                            <input type="text" class="form-control" name="caracteristiques" placeholder="Ex: 4x4, Automatique, Climatisation..." required>
                        </div>
                    </div>
                    <input type="hidden" name="id">
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline close-modal">Annuler</button>
                    <button type="submit" class="btn btn-primary">Enregistrer</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal Ajouter/Éditer Résidence -->
    <div id="residenceModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="residenceModalTitle">Ajouter une résidence</h3>
                <button class="close-modal">&times;</button>
            </div>
            <form id="residenceForm">
                <div class="modal-body">
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Titre *</label>
                            <input type="text" class="form-control" name="titre" required>
                        </div>
                        <div class="form-group">
                            <label>Localisation *</label>
                            <input type="text" class="form-control" name="localisation" required>
                        </div>
                        <div class="form-group">
                            <label>Prix/mois (FCFA) *</label>
                            <input type="number" class="form-control" name="prix" required>
                        </div>
                        <div class="form-group">
                            <label>Nombre de pièces *</label>
                            <input type="number" class="form-control" name="rooms" required>
                        </div>
                        <div class="form-group">
                            <label>URL de l'image *</label>
                            <input type="url" class="form-control" name="image" required>
                        </div>
                        <div class="form-group">
                            <label>Disponibilité *</label>
                            <select class="form-control" name="disponible" required>
                                <option value="true">Disponible</option>
                                <option value="false">Non disponible</option>
                            </select>
                        </div>
                        <div class="form-group" style="grid-column: 1 / -1;">
                            <label>Description *</label>
                            <textarea class="form-control" name="description" rows="3" required></textarea>
                        </div>
                        <div class="form-group" style="grid-column: 1 / -1;">
                            <label>Caractéristiques (séparées par des virgules) *</label>
                            <input type="text" class="form-control" name="caracteristiques" placeholder="Ex: 80m², 3 chambres, Balcon..." required>
                        </div>
                    </div>
                    <input type="hidden" name="id">
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline close-modal">Annuler</button>
                    <button type="submit" class="btn btn-primary">Enregistrer</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal Confirmation -->
    <div id="confirmModal" class="modal">
        <div class="modal-content" style="max-width: 400px;">
            <div class="modal-header">
                <h3>Confirmation</h3>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <p id="confirmMessage">Êtes-vous sûr de vouloir effectuer cette action ?</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-outline close-modal">Annuler</button>
                <button type="button" class="btn btn-danger" id="confirmActionBtn">Confirmer</button>
            </div>
        </div>
    </div>

    <script>
        // Script principal de l'admin
        class AdminManager {
            constructor() {
                this.data = null;
                this.currentSection = 'dashboard';
                this.init();
            }

            async init() {
                await this.loadData();
                this.setupEventListeners();
                this.showSection('dashboard');
                this.updateDashboard();
            }

            async loadData() {
                try {
                    const response = await fetch('data/donnees.json');
                    this.data = await response.json();
                    console.log('✅ Données chargées');
                } catch (error) {
                    console.error('❌ Erreur de chargement:', error);
                    this.showNotification('Erreur de chargement des données', 'error');
                }
            }

            async saveData() {
                try {
                    // Dans une vraie application, vous enverriez ces données au serveur
                    // Pour cette démo, nous simulons juste la sauvegarde
                    localStorage.setItem('graceAutoData', JSON.stringify(this.data));
                    this.showNotification('Données sauvegardées avec succès', 'success');
                    this.updateLastSync();
                } catch (error) {
                    console.error('❌ Erreur de sauvegarde:', error);
                    this.showNotification('Erreur lors de la sauvegarde', 'error');
                }
            }

            setupEventListeners() {
                // Navigation
                document.querySelectorAll('.admin-nav-item').forEach(item => {
                    item.addEventListener('click', (e) => {
                        e.preventDefault();
                        const section = item.dataset.section;
                        if (section) {
                            this.showSection(section);
                        }
                    });
                });

                // Boutons d'action
                document.getElementById('syncNowBtn').addEventListener('click', () => this.syncData());
                document.getElementById('addVehiculeBtn').addEventListener('click', () => this.openVehiculeModal());
                document.getElementById('addResidenceBtn').addEventListener('click', () => this.openResidenceModal());

                // Recherches
                document.getElementById('searchVehicules').addEventListener('input', (e) => this.filterVehicules(e.target.value));
                document.getElementById('searchResidences').addEventListener('input', (e) => this.filterResidences(e.target.value));

                // Formulaires
                document.getElementById('vehiculeForm').addEventListener('submit', (e) => this.saveVehicule(e));
                document.getElementById('residenceForm').addEventListener('submit', (e) => this.saveResidence(e));
                document.getElementById('settingsForm').addEventListener('submit', (e) => this.saveSettings(e));

                // Boutons base de données
                document.getElementById('exportDataBtn').addEventListener('click', () => this.exportData());
                document.getElementById('backupDataBtn').addEventListener('click', () => this.backupData());

                // Fermer les modals
                document.querySelectorAll('.close-modal').forEach(btn => {
                    btn.addEventListener('click', () => this.closeModals());
                });

                // Logout
                document.getElementById('logoutBtn').addEventListener('click', (e) => {
                    e.preventDefault();
                    if (confirm('Êtes-vous sûr de vouloir vous déconnecter ?')) {
                        window.location.href = 'index.html';
                    }
                });
            }

            showSection(section) {
                // Mettre à jour la navigation
                document.querySelectorAll('.admin-nav-item').forEach(item => {
                    item.classList.remove('active');
                    if (item.dataset.section === section) {
                        item.classList.add('active');
                    }
                });

                // Mettre à jour le titre
                const titles = {
                    'dashboard': 'Tableau de bord',
                    'vehicules': 'Gestion des véhicules',
                    'residences': 'Gestion des résidences',
                    'reservations': 'Gestion des réservations',
                    'settings': 'Paramètres du site',
                    'database': 'Base de données'
                };
                document.getElementById('sectionTitle').textContent = titles[section] || 'Administration';

                // Afficher la section
                document.querySelectorAll('.admin-section').forEach(sec => {
                    sec.style.display = 'none';
                });
                document.getElementById(`${section}Section`).style.display = 'block';

                // Charger les données spécifiques
                switch(section) {
                    case 'vehicules':
                        this.loadVehiculesTable();
                        break;
                    case 'residences':
                        this.loadResidencesTable();
                        break;
                    case 'reservations':
                        this.loadReservationsTable();
                        break;
                    case 'settings':
                        this.loadSettings();
                        break;
                }
            }

            updateDashboard() {
                if (!this.data) return;

                // Mettre à jour les statistiques
                const stats = {
                    totalVehicules: this.data.vehicules.length,
                    totalResidences: this.data.residences.length,
                    totalReservations: this.data.reservations.length,
                    connectedClients: Math.floor(Math.random() * 10) // Simulé
                };

                Object.keys(stats).forEach(key => {
                    const element = document.getElementById(key);
                    if (element) {
                        element.textContent = stats[key];
                    }
                });

                // Mettre à jour l'activité récente
                this.loadRecentActivity();
                this.updateLastSync();
            }

            updateLastSync() {
                const now = new Date();
                document.getElementById('lastSync').textContent = 
                    `${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}`;
            }

            async syncData() {
                const loadingBtn = document.getElementById('syncNowBtn');
                const originalHtml = loadingBtn.innerHTML;
                loadingBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Synchronisation...';
                loadingBtn.disabled = true;

                // Simuler la synchronisation
                await new Promise(resolve => setTimeout(resolve, 1500));

                await this.loadData();
                this.updateDashboard();
                this.showNotification('Synchronisation réussie', 'success');

                loadingBtn.innerHTML = originalHtml;
                loadingBtn.disabled = false;
            }

            // Gestion des véhicules
            loadVehiculesTable() {
                const tbody = document.getElementById('vehiculesTable');
                tbody.innerHTML = '';

                this.data.vehicules.forEach(vehicule => {
                    const row = document.createElement('tr');
                    
                    // Déterminer le statut
                    let statusClass = 'status-disponible';
                    let statusText = 'Disponible';
                    
                    if (!vehicule.disponible) {
                        statusClass = vehicule.categorie === 'vente' ? 'status-vendu' : 'status-loué';
                        statusText = vehicule.categorie === 'vente' ? 'Vendu' : 'Loué';
                    }

                    row.innerHTML = `
                        <td>
                            <img src="${vehicule.image}" alt="${vehicule.titre}" class="item-image-small" 
                                 onerror="this.src='https://via.placeholder.com/60x40?text=Image'">
                        </td>
                        <td>${vehicule.titre}</td>
                        <td><span class="type-badge">${vehicule.type}</span></td>
                        <td>${this.formatPrice(vehicule.prix)}</td>
                        <td><span class="status-badge ${statusClass}">${statusText}</span></td>
                        <td>
                            <select class="form-control disponibilite-select" data-id="${vehicule.id}" style="width: 100%;">
                                <option value="true" ${vehicule.disponible ? 'selected' : ''}>Disponible</option>
                                <option value="false" ${!vehicule.disponible ? 'selected' : ''}>${vehicule.categorie === 'vente' ? 'Marquer vendu' : 'Marquer loué'}</option>
                            </select>
                        </td>
                        <td class="actions-cell">
                            <button class="action-btn btn-edit" onclick="admin.editVehicule(${vehicule.id})">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="action-btn btn-delete" onclick="admin.deleteItem('vehicule', ${vehicule.id})">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    `;

                    tbody.appendChild(row);
                });

                // Ajouter les écouteurs pour les sélecteurs de disponibilité
                document.querySelectorAll('.disponibilite-select').forEach(select => {
                    select.addEventListener('change', (e) => {
                        const id = parseInt(e.target.dataset.id);
                        const disponible = e.target.value === 'true';
                        this.updateDisponibilite('vehicule', id, disponible);
                    });
                });
            }

            openVehiculeModal(vehicule = null) {
                const modal = document.getElementById('vehiculeModal');
                const form = document.getElementById('vehiculeForm');
                const title = document.getElementById('vehiculeModalTitle');

                if (vehicule) {
                    title.textContent = 'Modifier le véhicule';
                    form.querySelector('[name="id"]').value = vehicule.id;
                    form.querySelector('[name="titre"]').value = vehicule.titre;
                    form.querySelector('[name="categorie"]').value = vehicule.categorie;
                    form.querySelector('[name="prix"]').value = vehicule.prix;
                    form.querySelector('[name="image"]').value = vehicule.image;
                    form.querySelector('[name="type"]').value = vehicule.type;
                    form.querySelector('[name="disponible"]').value = vehicule.disponible.toString();
                    form.querySelector('[name="description"]').value = vehicule.description;
                    form.querySelector('[name="caracteristiques"]').value = 
                        Array.isArray(vehicule.caracteristiques) ? 
                        vehicule.caracteristiques.join(', ') : 
                        vehicule.caracteristiques;
                } else {
                    title.textContent = 'Ajouter un véhicule';
                    form.reset();
                    form.querySelector('[name="id"]').value = '';
                }

                modal.classList.add('active');
            }

            async saveVehicule(e) {
                e.preventDefault();
                const form = e.target;
                const formData = new FormData(form);
                const vehiculeData = Object.fromEntries(formData.entries());

                // Traitement des données
                vehiculeData.id = vehiculeData.id || Date.now();
                vehiculeData.prix = parseInt(vehiculeData.prix);
                vehiculeData.disponible = vehiculeData.disponible === 'true';
                vehiculeData.caracteristiques = vehiculeData.caracteristiques
                    .split(',')
                    .map(c => c.trim())
                    .filter(c => c);

                if (vehiculeData.id) {
                    // Édition
                    const index = this.data.vehicules.findIndex(v => v.id == vehiculeData.id);
                    if (index !== -1) {
                        this.data.vehicules[index] = vehiculeData;
                    }
                } else {
                    // Ajout
                    vehiculeData.id = Date.now();
                    vehiculeData.createdAt = new Date().toISOString();
                    this.data.vehicules.push(vehiculeData);
                }

                await this.saveData();
                this.closeModals();
                this.loadVehiculesTable();
                this.showNotification('Véhicule enregistré avec succès', 'success');
            }

            editVehicule(id) {
                const vehicule = this.data.vehicules.find(v => v.id == id);
                if (vehicule) {
                    this.openVehiculeModal(vehicule);
                }
            }

            // Gestion des résidences
            loadResidencesTable() {
                const tbody = document.getElementById('residencesTable');
                tbody.innerHTML = '';

                this.data.residences.forEach(residence => {
                    const statusClass = residence.disponible ? 'status-disponible' : 'status-loué';
                    const statusText = residence.disponible ? 'Disponible' : 'Louée';

                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>
                            <img src="${residence.image}" alt="${residence.titre}" class="item-image-small" 
                                 onerror="this.src='https://via.placeholder.com/60x40?text=Image'">
                        </td>
                        <td>${residence.titre}</td>
                        <td>${residence.localisation || '-'}</td>
                        <td>${this.formatPrice(residence.prix, true)}</td>
                        <td>${residence.rooms || '-'}</td>
                        <td><span class="status-badge ${statusClass}">${statusText}</span></td>
                        <td>
                            <select class="form-control disponibilite-select" data-id="${residence.id}" data-type="residence" style="width: 100%;">
                                <option value="true" ${residence.disponible ? 'selected' : ''}>Disponible</option>
                                <option value="false" ${!residence.disponible ? 'selected' : ''}>Marquer louée</option>
                            </select>
                        </td>
                        <td class="actions-cell">
                            <button class="action-btn btn-edit" onclick="admin.editResidence(${residence.id})">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="action-btn btn-delete" onclick="admin.deleteItem('residence', ${residence.id})">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    `;

                    tbody.appendChild(row);
                });

                document.querySelectorAll('.disponibilite-select[data-type="residence"]').forEach(select => {
                    select.addEventListener('change', (e) => {
                        const id = parseInt(e.target.dataset.id);
                        const disponible = e.target.value === 'true';
                        this.updateDisponibilite('residence', id, disponible);
                    });
                });
            }

            openResidenceModal(residence = null) {
                const modal = document.getElementById('residenceModal');
                const form = document.getElementById('residenceForm');
                const title = document.getElementById('residenceModalTitle');

                if (residence) {
                    title.textContent = 'Modifier la résidence';
                    form.querySelector('[name="id"]').value = residence.id;
                    form.querySelector('[name="titre"]').value = residence.titre;
                    form.querySelector('[name="localisation"]').value = residence.localisation || '';
                    form.querySelector('[name="prix"]').value = residence.prix;
                    form.querySelector('[name="rooms"]').value = residence.rooms || '';
                    form.querySelector('[name="image"]').value = residence.image;
                    form.querySelector('[name="disponible"]').value = residence.disponible.toString();
                    form.querySelector('[name="description"]').value = residence.description;
                    form.querySelector('[name="caracteristiques"]').value = 
                        Array.isArray(residence.caracteristiques) ? 
                        residence.caracteristiques.join(', ') : 
                        residence.caracteristiques || '';
                } else {
                    title.textContent = 'Ajouter une résidence';
                    form.reset();
                    form.querySelector('[name="id"]').value = '';
                    form.querySelector('[name="categorie"]').value = 'location';
                }

                modal.classList.add('active');
            }

            async saveResidence(e) {
                e.preventDefault();
                const form = e.target;
                const formData = new FormData(form);
                const residenceData = Object.fromEntries(formData.entries());

                // Traitement des données
                residenceData.id = residenceData.id || Date.now();
                residenceData.prix = parseInt(residenceData.prix);
                residenceData.rooms = parseInt(residenceData.rooms);
                residenceData.disponible = residenceData.disponible === 'true';
                residenceData.categorie = 'location';
                residenceData.caracteristiques = residenceData.caracteristiques
                    .split(',')
                    .map(c => c.trim())
                    .filter(c => c);

                if (residenceData.id) {
                    // Édition
                    const index = this.data.residences.findIndex(r => r.id == residenceData.id);
                    if (index !== -1) {
                        this.data.residences[index] = residenceData;
                    }
                } else {
                    // Ajout
                    residenceData.id = Date.now();
                    residenceData.createdAt = new Date().toISOString();
                    this.data.residences.push(residenceData);
                }

                await this.saveData();
                this.closeModals();
                this.loadResidencesTable();
                this.showNotification('Résidence enregistrée avec succès', 'success');
            }

            editResidence(id) {
                const residence = this.data.residences.find(r => r.id == id);
                if (residence) {
                    this.openResidenceModal(residence);
                }
            }

            // Gestion des réservations
            loadReservationsTable() {
                const tbody = document.getElementById('reservationsTable');
                tbody.innerHTML = '';

                if (this.data.reservations.length === 0) {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td colspan="8" style="text-align: center; padding: 2rem;">
                            <i class="fas fa-calendar-times" style="font-size: 2rem; color: #95a5a6; margin-bottom: 1rem;"></i>
                            <p>Aucune réservation pour le moment</p>
                        </td>
                    `;
                    tbody.appendChild(row);
                    return;
                }

                this.data.reservations.forEach(reservation => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${reservation.id}</td>
                        <td>${reservation.clientNom}<br><small>${reservation.clientEmail}</small></td>
                        <td>${reservation.itemTitre}</td>
                        <td><span class="type-badge">${reservation.type}</span></td>
                        <td>${new Date(reservation.dateDebut).toLocaleDateString('fr-FR')}</td>
                        <td>${new Date(reservation.dateFin).toLocaleDateString('fr-FR')}</td>
                        <td><span class="status-badge status-${reservation.statut}">${reservation.statut}</span></td>
                        <td class="actions-cell">
                            <button class="action-btn btn-view" onclick="admin.viewReservation(${reservation.id})">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="action-btn btn-delete" onclick="admin.deleteReservation(${reservation.id})">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    `;
                    tbody.appendChild(row);
                });
            }

            // Paramètres
            loadSettings() {
                const form = document.getElementById('settingsForm');
                const settings = this.data.settings || {};

                form.querySelector('[name="name"]').value = settings.name || '';
                form.querySelector('[name="description"]').value = settings.description || '';
                form.querySelector('[name="contactPhone"]').value = settings.contactPhone || '';
                form.querySelector('[name="contactEmail"]').value = settings.contactEmail || '';
                form.querySelector('[name="weekdayHours"]').value = settings.businessHours?.weekday || '';
                form.querySelector('[name="saturdayHours"]').value = settings.businessHours?.saturday || '';
            }

            async saveSettings(e) {
                e.preventDefault();
                const form = e.target;
                const formData = new FormData(form);
                const settingsData = Object.fromEntries(formData.entries());

                this.data.settings = {
                    ...this.data.settings,
                    name: settingsData.name,
                    description: settingsData.description,
                    contactPhone: settingsData.contactPhone,
                    contactEmail: settingsData.contactEmail,
                    businessHours: {
                        weekday: settingsData.weekdayHours,
                        saturday: settingsData.saturdayHours,
                        sunday: 'Dimanche: Fermé'
                    }
                };

                await this.saveData();
                this.showNotification('Paramètres enregistrés avec succès', 'success');
            }

            // Utilitaires
            async updateDisponibilite(type, id, disponible) {
                let collection = type === 'vehicule' ? this.data.vehicules : this.data.residences;
                const item = collection.find(item => item.id == id);
                
                if (item) {
                    item.disponible = disponible;
                    await this.saveData();
                    
                    const message = disponible ? 
                        'Item marqué comme disponible' : 
                        type === 'vehicule' ? 'Véhicule marqué comme vendu/loué' : 'Résidence marquée comme louée';
                    
                    this.showNotification(message, 'success');
                }
            }

            async deleteItem(type, id) {
                if (confirm(`Êtes-vous sûr de vouloir supprimer cet élément ?`)) {
                    let collection = type === 'vehicule' ? this.data.vehicules : this.data.residences;
                    const index = collection.findIndex(item => item.id == id);
                    
                    if (index !== -1) {
                        collection.splice(index, 1);
                        await this.saveData();
                        
                        if (type === 'vehicule') {
                            this.loadVehiculesTable();
                        } else {
                            this.loadResidencesTable();
                        }
                        
                        this.showNotification('Élément supprimé avec succès', 'success');
                    }
                }
            }

            loadRecentActivity() {
                const tbody = document.getElementById('recentActivity');
                tbody.innerHTML = '';

                // Combiner tous les items et trier par date
                const allItems = [
                    ...this.data.vehicules.map(v => ({ ...v, type: 'vehicule' })),
                    ...this.data.residences.map(r => ({ ...r, type: 'residence' }))
                ].sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt))
                 .slice(0, 10);

                allItems.forEach(item => {
                    const row = document.createElement('tr');
                    const typeIcon = item.type === 'vehicule' ? 'fa-car' : 'fa-home';
                    const statusClass = item.disponible ? 'status-disponible' : 
                                      item.type === 'vehicule' && item.categorie === 'vente' ? 'status-vendu' : 'status-loué';
                    const statusText = item.disponible ? 'Disponible' : 
                                     item.type === 'vehicule' && item.categorie === 'vente' ? 'Vendu' : 'Loué';

                    row.innerHTML = `
                        <td><i class="fas ${typeIcon}"></i> ${item.type === 'vehicule' ? 'Véhicule' : 'Résidence'}</td>
                        <td>${item.titre}</td>
                        <td>${this.formatPrice(item.prix, item.categorie === 'location')}</td>
                        <td><span class="status-badge ${statusClass}">${statusText}</span></td>
                        <td>${new Date(item.createdAt).toLocaleDateString('fr-FR')}</td>
                        <td class="actions-cell">
                            <button class="action-btn btn-view" onclick="admin.viewItem('${item.type}', ${item.id})">
                                <i class="fas fa-eye"></i>
                            </button>
                        </td>
                    `;
                    tbody.appendChild(row);
                });
            }

            filterVehicules(search) {
                const rows = document.querySelectorAll('#vehiculesTable tr');
                const searchTerm = search.toLowerCase();

                rows.forEach(row => {
                    const text = row.textContent.toLowerCase();
                    row.style.display = text.includes(searchTerm) ? '' : 'none';
                });
            }

            filterResidences(search) {
                const rows = document.querySelectorAll('#residencesTable tr');
                const searchTerm = search.toLowerCase();

                rows.forEach(row => {
                    const text = row.textContent.toLowerCase();
                    row.style.display = text.includes(searchTerm) ? '' : 'none';
                });
            }

            // Base de données
            exportData() {
                const dataStr = JSON.stringify(this.data, null, 2);
                const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
                
                const exportFileDefaultName = `grace-auto-service-backup-${new Date().toISOString().split('T')[0]}.json`;
                
                const linkElement = document.createElement('a');
                linkElement.setAttribute('href', dataUri);
                linkElement.setAttribute('download', exportFileDefaultName);
                linkElement.click();
                
                this.showNotification('Données exportées avec succès', 'success');
            }

            backupData() {
                localStorage.setItem('graceAutoBackup', JSON.stringify(this.data));
                this.showNotification('Sauvegarde locale effectuée', 'success');
            }

            // Affichage
            formatPrice(price, isMonthly = false) {
                if (!price) return 'Prix sur demande';
                const formatted = new Intl.NumberFormat('fr-FR').format(price);
                return `${formatted} FCFA${isMonthly ? '/mois' : ''}`;
            }

            showNotification(message, type = 'info') {
                // Créer la notification
                const notification = document.createElement('div');
                notification.className = `notification ${type}`;
                notification.innerHTML = `
                    <i class="fas fa-${type === 'success' ? 'check-circle' : 
                                      type === 'error' ? 'exclamation-circle' : 
                                      type === 'warning' ? 'exclamation-triangle' : 'info-circle'}"></i>
                    <span>${message}</span>
                `;

                document.body.appendChild(notification);

                // Supprimer après 3 secondes
                setTimeout(() => {
                    notification.style.animation = 'slideInRight 0.3s ease reverse forwards';
                    setTimeout(() => notification.remove(), 300);
                }, 3000);
            }

            closeModals() {
                document.querySelectorAll('.modal').forEach(modal => {
                    modal.classList.remove('active');
                });
                document.querySelectorAll('form').forEach(form => {
                    form.reset();
                });
            }

            viewItem(type, id) {
                alert(`Voir ${type} #${id} - Cette fonctionnalité sera implémentée dans la version complète`);
            }

            viewReservation(id) {
                alert(`Voir réservation #${id} - Cette fonctionnalité sera implémentée dans la version complète`);
            }

            deleteReservation(id) {
                if (confirm('Êtes-vous sûr de vouloir supprimer cette réservation ?')) {
                    const index = this.data.reservations.findIndex(r => r.id == id);
                    if (index !== -1) {
                        this.data.reservations.splice(index, 1);
                        this.saveData();
                        this.loadReservationsTable();
                        this.showNotification('Réservation supprimée', 'success');
                    }
                }
            }
        }

        // Initialiser l'admin
        const admin = new AdminManager();
        window.admin = admin; // Pour l'utiliser dans les onclick
    </script>
</body>
</html>
